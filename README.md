# Codedance - Kubernetes æ™ºèƒ½å‘å¸ƒç³»ç»Ÿ

åŸºäº Kubernetes çš„æ™ºèƒ½å‘å¸ƒç³»ç»Ÿï¼Œæ”¯æŒç°åº¦å‘å¸ƒã€å®æ—¶ç›‘æ§ã€è‡ªåŠ¨æš‚åœå’Œå›æ»šã€‚

## æ¦‚è¿°

Codedance æ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„ Kubernetes ç°åº¦å‘å¸ƒè§£å†³æ–¹æ¡ˆï¼Œæä¾›ï¼š

- **æ™ºèƒ½ç°åº¦å‘å¸ƒ**: æ”¯æŒçº¿æ€§ã€æŒ‡æ•°å’Œæ‰‹åŠ¨ä¸‰ç§å‘å¸ƒç­–ç•¥
- **å®æ—¶å¥åº·ç›‘æ§**: åŸºäº Prometheus çš„æŒ‡æ ‡åˆ†æå’Œå¥åº·è¯„åˆ†
- **è‡ªåŠ¨å†³ç­–å¼•æ“**: æ ¹æ®æŒ‡æ ‡è‡ªåŠ¨å†³å®šç»§ç»­ã€æš‚åœæˆ–å›æ»š
- **å¤šç§æµé‡ç®¡ç†**: æ”¯æŒ Istio å’Œ Nginx Ingress
- **æ•…éšœè‡ªåŠ¨å›æ»š**: æ£€æµ‹å¼‚å¸¸è‡ªåŠ¨å›æ»šåˆ°ç¨³å®šç‰ˆæœ¬

## æ ¸å¿ƒç‰¹æ€§

### ç°åº¦å‘å¸ƒç­–ç•¥

- **çº¿æ€§é€’å¢ (Linear)**: 5% â†’ 10% â†’ 25% â†’ 50% â†’ 75% â†’ 100%
- **æŒ‡æ•°é€’å¢ (Exponential)**: 1% â†’ 5% â†’ 10% â†’ 25% â†’ 50% â†’ 100%
- **æ‰‹åŠ¨æ§åˆ¶ (Manual)**: ç”¨æˆ·æ‰‹åŠ¨æ§åˆ¶æ¯ä¸ªé˜¶æ®µçš„æµé‡åˆ‡æ¢

### ç›‘æ§ä¸å†³ç­–

- **æˆåŠŸç‡ç›‘æ§**: å®æ—¶ç›‘æ§ HTTP 2xx å“åº”å æ¯”
- **å»¶è¿Ÿåˆ†æ**: P50/P90/P99 å»¶è¿ŸæŒ‡æ ‡
- **é”™è¯¯ç‡è¿½è¸ª**: HTTP 5xx é”™è¯¯ç‡ç›‘æ§
- **Pod å¥åº·æ£€æŸ¥**: è‡ªåŠ¨æ£€æµ‹ Pod çŠ¶æ€
- **æ™ºèƒ½å†³ç­–**: åŸºäºå¤šç»´åº¦æŒ‡æ ‡è‡ªåŠ¨å†³ç­–

### æµé‡ç®¡ç†

- **Istio æ”¯æŒ**: åŸºäº VirtualService å’Œ DestinationRule
- **Nginx Ingress**: ä½¿ç”¨ Canary Annotations
- **åŠ¨æ€æƒé‡è°ƒæ•´**: å¹³æ»‘çš„æµé‡åˆ‡æ¢

### è‡ªåŠ¨å›æ»š

- **æŒ‡æ ‡å¼‚å¸¸å›æ»š**: æˆåŠŸç‡ã€å»¶è¿Ÿã€é”™è¯¯ç‡è¶…é˜ˆå€¼è‡ªåŠ¨å›æ»š
- **Pod å´©æºƒå›æ»š**: æ£€æµ‹åˆ° Pod å¼‚å¸¸è‡ªåŠ¨å›æ»š
- **æ‰‹åŠ¨å›æ»š**: æ”¯æŒç”¨æˆ·æ‰‹åŠ¨è§¦å‘å›æ»š

## å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

- Kubernetes é›†ç¾¤ (v1.24+)
- kubectl å‘½ä»¤è¡Œå·¥å…·
- Prometheus ç›‘æ§ç³»ç»Ÿ
- Istio æˆ– Nginx Ingress Controller
- Go 1.21+ (ç”¨äºå¼€å‘)

### å®‰è£…

1. å…‹éš†ä»“åº“ï¼š
```bash
git clone https://github.com/codefarmer009/codedance.git
cd codedance
```

2. å®‰è£… CRDï¼š
```bash
kubectl apply -f config/crd/canary_deployment.yaml
```

3. åˆ›å»º RBAC æƒé™ï¼š
```bash
kubectl apply -f config/rbac/
```

4. éƒ¨ç½²æ§åˆ¶å™¨ï¼š
```bash
kubectl apply -f deploy/kubernetes/controller.yaml
```

5. éªŒè¯å®‰è£…ï¼š
```bash
kubectl get pods -n codedance-system
```

### ä½¿ç”¨ç¤ºä¾‹

1. éƒ¨ç½²åº”ç”¨ï¼š
```bash
kubectl apply -f config/samples/deployment_example.yaml
```

2. åˆ›å»ºç°åº¦å‘å¸ƒï¼š
```bash
kubectl apply -f config/samples/example_canary.yaml
```

3. æŸ¥çœ‹å‘å¸ƒçŠ¶æ€ï¼š
```bash
kubectl get canarydeployment -n production
kubectl describe canarydeployment codedance-app -n production
```

## é¡¹ç›®ç»“æ„

```
codedance/
â”œâ”€â”€ cmd/                    # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ controller/         # æ§åˆ¶å™¨ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ api-server/         # API æœåŠ¡å™¨
â”‚   â””â”€â”€ cli/                # å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ pkg/                    # æ ¸å¿ƒä»£ç åŒ…
â”‚   â”œâ”€â”€ apis/               # API å®šä¹‰
â”‚   â”‚   â””â”€â”€ deploy/v1alpha1/  # CRD ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ controller/         # æ§åˆ¶å™¨é€»è¾‘
â”‚   â”œâ”€â”€ metrics/            # æŒ‡æ ‡æ”¶é›†
â”‚   â”œâ”€â”€ traffic/            # æµé‡ç®¡ç†
â”‚   â”œâ”€â”€ strategy/           # å‘å¸ƒç­–ç•¥
â”‚   â””â”€â”€ utils/              # å·¥å…·å‡½æ•°
â”œâ”€â”€ config/                 # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ crd/                # CRD å®šä¹‰
â”‚   â”œâ”€â”€ rbac/               # RBAC é…ç½®
â”‚   â””â”€â”€ samples/            # ç¤ºä¾‹é…ç½®
â”œâ”€â”€ deploy/                 # éƒ¨ç½²æ–‡ä»¶
â”‚   â”œâ”€â”€ kubernetes/         # K8s éƒ¨ç½²æ¸…å•
â”‚   â””â”€â”€ helm/               # Helm Charts
â”œâ”€â”€ docs/                   # æ–‡æ¡£
â”‚   â”œâ”€â”€ architecture.md     # æ¶æ„è®¾è®¡
â”‚   â”œâ”€â”€ getting-started.md  # å¿«é€Ÿå¼€å§‹
â”‚   â””â”€â”€ api-reference.md    # API å‚è€ƒ
â”œâ”€â”€ Dockerfile              # Docker é•œåƒ
â”œâ”€â”€ Makefile                # æ„å»ºè„šæœ¬
â””â”€â”€ go.mod                  # Go æ¨¡å—å®šä¹‰
```

## å¼€å‘æŒ‡å—

### æœ¬åœ°è¿è¡Œ

```bash
make controller
```

æˆ–è€…ï¼š

```bash
go run cmd/controller/main.go --kubeconfig=$HOME/.kube/config
```

### æ„å»º

```bash
make build
```

### æ„å»º Docker é•œåƒ

```bash
make docker-build VERSION=v1.0.0
```

### è¿è¡Œæµ‹è¯•

```bash
make test
```

### ä»£ç æ ¼å¼åŒ–

```bash
make fmt
```

## æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å‘å¸ƒæ§åˆ¶å¹³é¢                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ å‘å¸ƒæ§åˆ¶å™¨    â”‚  â”‚ ç›‘æ§åˆ†æå™¨    â”‚  â”‚ å†³ç­–å¼•æ“      â”‚      â”‚
â”‚  â”‚ (Controller) â”‚â†’ â”‚ (Analyzer)   â”‚â†’ â”‚ (Decider)    â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚         â†“                 â†‘                  â†“               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ æµé‡ç®¡ç†å™¨    â”‚  â”‚ æŒ‡æ ‡æ”¶é›†å™¨    â”‚  â”‚ å›æ»šç®¡ç†å™¨    â”‚      â”‚
â”‚  â”‚ (Traffic)    â”‚  â”‚ (Metrics)    â”‚  â”‚ (Rollback)   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Kubernetes é›†ç¾¤                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚  Stable     â”‚  â†â†’   â”‚  Canary     â”‚                     â”‚
â”‚  â”‚  Pods (v1)  â”‚        â”‚  Pods (v2)  â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

è¯¦ç»†æ¶æ„è®¾è®¡è¯·å‚è€ƒ [æ¶æ„æ–‡æ¡£](docs/architecture.md)ã€‚

## å¯è§†åŒ–ç®¡ç†ç•Œé¢

Codedance æä¾›äº†ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ Web å¯è§†åŒ–ç®¡ç†ç•Œé¢ï¼Œç”¨äºå®æ—¶ç›‘æ§å’Œç®¡ç†ç°åº¦å‘å¸ƒã€‚

### ä¸»è¦åŠŸèƒ½

- ğŸ“Š **å®æ—¶ç›‘æ§**: å‘å¸ƒè¿›åº¦ã€æµé‡åˆ†é…ã€ç³»ç»ŸæŒ‡æ ‡
- ğŸ¯ **å¯è§†åŒ–æ­¥éª¤**: æ—¶é—´è½´å±•ç¤ºå‘å¸ƒçš„æ¯ä¸ªæ­¥éª¤
- ğŸ“ˆ **æŒ‡æ ‡ä»ªè¡¨æ¿**: æˆåŠŸç‡ã€å»¶è¿Ÿã€é”™è¯¯ç‡ç­‰å…³é”®æŒ‡æ ‡
- ğŸ” **æ™ºèƒ½ç­›é€‰**: æŒ‰çŠ¶æ€ã€åç§°å¿«é€ŸæŸ¥æ‰¾å‘å¸ƒä»»åŠ¡

### å¿«é€Ÿå¯åŠ¨

```bash
# æœ¬åœ°è¿è¡Œ
make dashboard

# æˆ–ç›´æ¥è¿è¡Œ
go run cmd/dashboard/main.go --kubeconfig=$HOME/.kube/config
```

è®¿é—®ï¼šhttp://localhost:8080

### Kubernetes éƒ¨ç½²

```bash
# éƒ¨ç½²åˆ°é›†ç¾¤
kubectl apply -f deploy/kubernetes/dashboard.yaml

# ç«¯å£è½¬å‘
kubectl port-forward -n codedance-system svc/codedance-dashboard 8080:80
```

è¯¦ç»†ä½¿ç”¨æŒ‡å—è¯·å‚è€ƒï¼š[å¯è§†åŒ–ç•Œé¢æ¼”ç¤ºæ–‡æ¡£](docs/dashboard-demo.md)

## æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹æŒ‡å—](docs/getting-started.md)
- [æ¶æ„è®¾è®¡æ–‡æ¡£](docs/architecture.md)
- [API å‚è€ƒæ–‡æ¡£](docs/api-reference.md)
- [å¯è§†åŒ–ç•Œé¢æ¼”ç¤º](docs/dashboard-demo.md)

## è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. åˆ›å»º Pull Request

## å¼€å‘è·¯çº¿å›¾

- [x] æ ¸å¿ƒç°åº¦å‘å¸ƒåŠŸèƒ½
- [x] Prometheus æŒ‡æ ‡é›†æˆ
- [x] Istio æµé‡ç®¡ç†
- [x] Nginx Ingress æ”¯æŒ
- [x] è‡ªåŠ¨å›æ»šæœºåˆ¶
- [x] Web å¯è§†åŒ–ç®¡ç†ç•Œé¢
- [ ] CLI å‘½ä»¤è¡Œå·¥å…·
- [ ] å¤šé›†ç¾¤æ”¯æŒ
- [ ] Helm Chart æ”¯æŒ
- [ ] AI å†³ç­–ä¼˜åŒ–
- [ ] æˆæœ¬åˆ†æåŠŸèƒ½

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Contact

Project Maintainer: [@codefarmer009](https://github.com/codefarmer009)

Project Link: [https://github.com/codefarmer009/codedance](https://github.com/codefarmer009/codedance)

## Acknowledgments

- Thanks to all contributors who help make this project better
- Inspired by the global dance community
- Built with modern web technologies

---

Made with â¤ï¸ by the codedance team
